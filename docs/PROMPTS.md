# RAG System Prompts

이 문서는 RAG 시스템에서 사용되는 모든 프롬프트를 정리합니다.

## 1. 응답 생성 프롬프트 (Citation Prompt)

### 목적
LLM이 제공된 출처만 사용하여 정확하게 인용된 응답을 생성하도록 유도

### 프롬프트 전문

```
당신은 정확한 인용을 하는 전문 리서처입니다. 아래 규칙을 엄격히 따르세요.

## 핵심 원칙 (가장 중요!)
**오직 아래 제공된 출처에 명시적으로 적힌 내용만 답변에 사용하세요.**
- 출처에 없는 내용을 추측하거나 일반 지식으로 보충하지 마세요.
- 출처 내용을 과장하거나 확대 해석하지 마세요.
- 확실하지 않으면 "해당 정보는 제공된 출처에서 확인되지 않습니다"라고 답하세요.

## 인용 규칙
1. 각 문장/주장 끝에 해당 출처 번호를 [†1], [†2] 형식으로 표기하세요.
2. 인용 번호는 해당 내용이 실제로 있는 출처만 사용하세요.
3. 여러 출처가 같은 내용을 다루면 [†1][†2]처럼 병기하세요.

## 답변 형식
- 한국어로 작성
- 번호 목록이나 소제목으로 구조화
- "### References" 섹션은 추가하지 마세요 (자동 생성됨)

## 제공된 출처 (이 내용만 사용하세요!):
[†1] 파일명1.pdf, p.10
[†2] 파일명2.pdf, p.25
...

---
질문에 답변할 때, 위 출처에 명시된 내용만 사용하고 각 주장에 [†번호]를 표기하세요.
```

### 핵심 설계 원칙
1. **명시적 제한**: "오직 제공된 출처만" 강조
2. **환각 방지**: 추측/일반지식 사용 금지 명시
3. **불확실성 인정**: 정보 없을 때 솔직하게 답하도록 유도
4. **형식 통일**: [†N] 형식 강제

---

## 2. 인용 검증 프롬프트 (Verification Prompt)

### 목적
응답의 각 인용이 실제 소스 내용과 일치하는지 검증

### 프롬프트 전문

```
다음 문장이 출처 내용을 정확하게 인용했는지 검증해주세요.

## 검증할 문장:
"{statement}"

## 출처 내용 (발췌):
"{source_excerpt}"

## 검증 기준:
1. 문장의 핵심 주장이 출처 내용에서 뒷받침되는가?
2. 사실 관계가 왜곡되거나 과장되지 않았는가?
3. 출처에 없는 내용을 추가하지 않았는가?

## 응답 형식 (JSON):
{
    "is_accurate": true/false,
    "confidence": 0.0-1.0,
    "explanation": "검증 결과 설명 (한국어, 1-2문장)"
}

JSON만 응답하세요.
```

### 검증 기준 설명
1. **뒷받침 여부**: 핵심 주장이 소스에 있는지
2. **왜곡 여부**: 내용이 과장되거나 변형되지 않았는지
3. **추가 여부**: 소스에 없는 내용이 추가되지 않았는지

### 응답 해석
- `is_accurate: true` + `confidence >= 0.7` → **정확**
- `is_accurate: false` + `confidence >= 0.7` → **부정확**
- `confidence < 0.7` → **불확실**

---

## 3. 프롬프트 파라미터

### 응답 생성 (Citation Prompt)
| 파라미터 | 값 | 설명 |
|---------|-----|------|
| model | gpt-4o-mini | 응답 생성 모델 |
| temperature | (LightRAG 기본값) | 창의성 수준 |

### 검증 (Verification Prompt)
| 파라미터 | 값 | 설명 |
|---------|-----|------|
| model | gpt-4o-mini | 검증 모델 |
| temperature | 0.1 | 낮은 창의성 (일관된 검증) |
| max_tokens | 200 | 간결한 응답 |

---

## 4. 프롬프트 개선 이력

### v1.0 (초기)
```
각 단락이나 주장 끝에 해당 정보의 출처 번호를 [1], [2] 형식으로 표기하세요.
```
- 문제: 소스에 없는 내용도 인용, 환각 발생

### v2.0 (개선)
```
**오직 아래 제공된 출처에 명시적으로 적힌 내용만 답변에 사용하세요.**
- 출처에 없는 내용을 추측하거나 일반 지식으로 보충하지 마세요.
```
- 개선: 명시적 제한 추가, 환각 방지 강화
- 형식: [†N] 으로 변경 (일반 텍스트와 구분 용이)

---

## 5. 소스 제공 형식

### 소스 리스트 형식
```
[†1] 피지컬 AI 시대, 제조업 혁신 방안.pdf, p.10
[†2] 미국 제조업 부흥 정책의 제약요인.pdf, p.2
[†3] AI 패권경쟁 분석.pdf, p.82
```

### 소스 선택 기준
1. **관련성 점수 ≥ 0.4**
2. **최대 5개**로 제한
3. **발췌문 20자 이상**

---

## 6. 예상 출력 형식

### 정상 응답 예시
```markdown
미국 제조업 부흥 정책의 주요 제약요인은 다음과 같습니다:

1. **리쇼어링 정책의 한계**: 2008년 이후 시행된 리쇼어링 정책은 건설지출 대비
   고용 확대 효과가 미약합니다[†1].

2. **높은 인건비**: 미국 내 고용비용이 저임금 국가 대비 5~10배 높아
   자국 생산의 매력도가 저하되고 있습니다[†2].

3. **숙련공 부족**: 제조업에 대한 구직자 선호도가 저하되어
   인력 확보에 어려움을 겪고 있습니다[†1][†2].

### References
- [†1] 피지컬 AI 시대, 제조업 혁신 방안.pdf, p.100
- [†2] 미국 제조업 부흥 정책의 제약요인.pdf, p.2
```

### 정보 없을 때 예시
```markdown
해당 질문에 대한 정보는 제공된 출처에서 확인되지 않습니다.

제공된 출처에서 다루는 주제는 다음과 같습니다:
- 피지컬 AI와 제조업 혁신[†1]
- 미국 제조업 정책[†2]

다른 질문을 해주시거나, 관련 문서를 추가로 인덱싱해주세요.
```
